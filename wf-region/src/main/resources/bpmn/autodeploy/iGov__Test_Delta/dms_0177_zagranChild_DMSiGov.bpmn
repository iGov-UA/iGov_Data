<?xml version="1.0" encoding="UTF-8"?>
<definitions xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:activiti="http://activiti.org/bpmn" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:omgdc="http://www.omg.org/spec/DD/20100524/DC" xmlns:omgdi="http://www.omg.org/spec/DD/20100524/DI" typeLanguage="http://www.w3.org/2001/XMLSchema" expressionLanguage="http://www.w3.org/1999/XPath" targetNamespace="http://www.activiti.org/test">
  <process id="dms_0177_zagranChild_DMSiGov" name="Паспорт громадянина для виїзду за кордон для дитини" isExecutable="true">
    <startEvent id="startevent1" name="Start" activiti:initiator="initiator">
      <extensionElements>
        <activiti:formProperty id="sWarning0" name=" ; ;labelType=info" type="label" default="Для оформлення закордонного паспорту для дорослого існує окрема &lt;a href=&quot;https://igov.org.ua/service/176/general&quot;&gt;послуга&lt;/a&gt;"></activiti:formProperty>
        <activiti:formProperty id="bankIdlastName" name="Прізвище" type="string"></activiti:formProperty>
        <activiti:formProperty id="bankIdfirstName" name="Ім'я" type="string"></activiti:formProperty>
        <activiti:formProperty id="bankIdmiddleName" name="По батькові" type="string"></activiti:formProperty>
        
        <activiti:formProperty id="tPassport" name="Паспорт заявника; (серія, номер, дата і орган, що його видав)" type="textArea" required="true"></activiti:formProperty>
        <activiti:formProperty id="bankIdPassport" name="Паспортні дані ; ;bVisible=false" type="string"></activiti:formProperty>
        
        <activiti:formProperty id="phone" name="Контактний телефон" type="string" required="true"></activiti:formProperty>
        <activiti:formProperty id="email" name="E-Mail адреса для зворотнього зв'язку" type="string" required="true"></activiti:formProperty>
        <activiti:formProperty id="bankIdphone" name="БанкІДтелефон; ;bVisible=false" type="string"></activiti:formProperty>
        <activiti:formProperty id="bankIdemail" name="БанкІДпошта; ;bVisible=false" type="string"></activiti:formProperty>
        <activiti:formProperty id="FlagBankId" name="FlagBankIdPhoneEmail; ;bVisible=false" type="string"></activiti:formProperty>
        <activiti:formProperty id="markerBankIdPasportPhoneEmail" name="markerBankIdPasportPhoneEmail" type="markers" default="${markerService.loadFromFile('1_Standart_marker/BankIdPasportPhoneEmail.json')}"></activiti:formProperty>
        
        <activiti:formProperty id="markersLine_1" name="Початок-блок для кого" type="markers" default="{&quot;attributes&quot;:{&quot;Line_1&quot;:{&quot;aElement_ID&quot;:[&quot;lastName_UA1&quot;],&quot;sValue&quot;:&quot;Дані особи, яка буде отримувати паспорт&quot;}}}"></activiti:formProperty>
        <activiti:formProperty id="lastName_UA1" name="Прізвище дитини" type="string" required="true"></activiti:formProperty>
        <activiti:formProperty id="firstName_UA1" name="Ім'я дитини" type="string" required="true"></activiti:formProperty>
        <activiti:formProperty id="middleName_UA1" name="По батькові дитини" type="string" required="true"></activiti:formProperty>
        <activiti:formProperty id="markersLine_2" name="Кынець-блок для кого" type="markers" default="{&quot;attributes&quot;:{&quot;Line_2&quot;:{&quot;aElement_ID&quot;:[&quot;sID_Public_SubjectOrganJoin&quot;],&quot;sValue&quot;:&quot; &quot;}}}"></activiti:formProperty>
        <activiti:formProperty id="sID_Public_SubjectOrganJoin" name="Оберіть підрозділ міграційної служби, в якому Ви будете отримувати паспорт" type="select" default="0" required="true"></activiti:formProperty>
        <activiti:formProperty id="sInfoFAQ" name=" ; ;labelType=info" type="label" default="Відповіді на найчастіші питання по закордонних паспортах (в т.ч. про наявність черги) Ви можете знайти за &lt;a href=&quot;https://docs.google.com/document/d/12tTbPz081dMJPxPicyXEe8xMMQdYNUet4Qx04VNCnys/edit?usp=sharing&quot;&gt;посиланням&lt;/a&gt;"></activiti:formProperty>
        <activiti:formProperty id="visitDay1" name="Оберіть зручний день та час з доступних місць у черзі" type="queueData" required="true"></activiti:formProperty>
        <activiti:formProperty id="nID_Department_visitDay1" name="Департамент; ;bVisible=false" type="string"></activiti:formProperty>
        <activiti:formProperty id="visitDay" name="Оберіть зручний день та час з доступних місць у черзі" type="queueData" required="true"></activiti:formProperty>
        <activiti:formProperty id="nID_ServiceCustomPrivate_visitDay" name="Номер черги за довідником ДМС; ;bVisible=false" type="string"></activiti:formProperty>
        <activiti:formProperty id="sID_Type_visitDay" name="sID_Type_visitDay; ;bVisible=false" type="string" default="DMS"></activiti:formProperty>
        <activiti:formProperty id="sTicketCode" name="Код талону; ;bVisible=false" type="string"></activiti:formProperty>
        <activiti:formProperty id="sTicketNumber" name="Номер талону; ;bVisible=false" type="string"></activiti:formProperty>
        <activiti:formProperty id="sCancelInfo" name="sCancelInfo; ;bVisible=false" type="string" default="Заявка актуальна"></activiti:formProperty>
        <activiti:formProperty id="sFlag" name="sFlag; ;bVisible=false" type="string" default="DMS"></activiti:formProperty>
        <activiti:formProperty id="markerFlag" name="markerFlag" type="markers" default="${markerService.loadFromFile('dms/DMSiGov.json')}"></activiti:formProperty>
        <activiti:formProperty id="sAddress" name="Адреса ДМС; ;bVisible=false" type="string"></activiti:formProperty>
        <activiti:formProperty id="sNameOrgan" name="Назва органу; ;bVisible=false" type="string"></activiti:formProperty>
        <activiti:formProperty id="sNotification_day" name="sNotification_day; ;bVisible=false" type="string"></activiti:formProperty>
        <activiti:formProperty id="sNotification_day1" name="sNotification_day1; ;bVisible=false" type="string"></activiti:formProperty>
        <activiti:formProperty id="sMailClerk" name="Пошта органу; ;bVisible=false" type="string" default=" "></activiti:formProperty>
        <activiti:formProperty id="sEndDay" name="Запуск таймера юзертаски; ;bVisible=false" type="string"></activiti:formProperty>
        <activiti:formProperty id="sRekvIDZagranPos" name="Реквізити; ;bVisible=false" type="string" default=" "></activiti:formProperty>
        <activiti:formProperty id="sPosluga_name" name="назва послуги; ;bVisible=false" type="string" default="Паспорт громадянина для виїзду за кордон для дитини"></activiti:formProperty>
        <activiti:formProperty id="sPosluga_nameZV" name="назва послуги; ;bVisible=false" type="string" default="паспорт громадянина для виїзду за кордон для дитини"></activiti:formProperty>
      </extensionElements>
    </startEvent>
    <sequenceFlow id="flow1" name="Черга ДМС" sourceRef="exclusivegateway1" targetRef="scripttask1">
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[${sFlag == 'DMS'}]]></conditionExpression>
    </sequenceFlow>
    <sequenceFlow id="flow45" name="Черга iGov" sourceRef="exclusivegateway1" targetRef="scripttask3">
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[${sFlag == 'iGov'}]]></conditionExpression>
    </sequenceFlow>
    <serviceTask id="servicetask1" name="для очереди" activiti:delegateExpression="#{procedQueueTickets}"></serviceTask>
    <boundaryEvent id="boundaryerror1" name="Error" attachedToRef="servicetask1">
      <errorEventDefinition></errorEventDefinition>
    </boundaryEvent>
    <sequenceFlow id="flow23" sourceRef="boundaryerror1" targetRef="endevent3"></sequenceFlow>
    <endEvent id="endevent3" name="End"></endEvent>
    <sequenceFlow id="flow10" sourceRef="servicetask1" targetRef="exclusivegateway1"></sequenceFlow>
    <scriptTask id="scripttask1" name="Формировка даты" scriptFormat="javascript" activiti:autoStoreVariables="false">
      <script>var src=execution.getVariable('visitDay')
var date_of_visit=src.substr(src.indexOf('"sDate":"')+9,16);
var tickNum=src.substr(src.indexOf('"ticket_number":"')+17,3);
var tickCode=src.substr(src.indexOf('"ticket_code":"')+15,src.indexOf('"',src.indexOf('"ticket_code":"')+15)-(src.indexOf('"ticket_code":"')+15));
execution.setVariable('sNotification_day', date_of_visit)
execution.setVariable('sTicketNumber', tickNum)
execution.setVariable('sTicketCode', tickCode)
var src=date_of_visit
var year=src.substr(0,4)
var month=src.substr(5,2)
var day=src.substr(8,2)
var hour=src.substr(11,2)
var minutes=src.substr(14,2)
var seconds='00'
var delta=1
var day1=day
var month1=month
if (day!='01')
    {
        day1=+day-delta
    }
else
    {
        if ((month!='01')&amp;&amp;(month!='03'))
          {
              month1=+month-1
              day1=30
          }
        else
          {
            if (month=='03')
            {
              month1='02'
              day1='28'
            }            
          }
     }
var timerEnd=year+'-'+month+'-'+day+'T'+'19'+':'+'00'+':'+seconds
execution.setVariable('sEndDay', timerEnd)</script>
    </scriptTask>
    <sequenceFlow id="flow28" sourceRef="scripttask1" targetRef="servicetask3"></sequenceFlow>
    <serviceTask id="servicetask3" name="біометричний не терміновий" activiti:delegateExpression="#{MailTaskWithoutAttachmentAndWithSms}">
      <extensionElements>
        <activiti:field name="sPhone_SMS">
          <activiti:expression><![CDATA[${phone}]]></activiti:expression>
        </activiti:field>
        <activiti:field name="sText_SMS">
          <activiti:expression><![CDATA[Vashe zvernennya [sID_Order] zareestrovano. Detali: igov.org.ua/journal abo u Vashomu email]]></activiti:expression>
        </activiti:field>
        <activiti:field name="to">
          <activiti:expression><![CDATA[${email}]]></activiti:expression>
        </activiti:field>
        <activiti:field name="from">
          <activiti:string><![CDATA[noreply@igov.org.ua]]></activiti:string>
        </activiti:field>
        <activiti:field name="subject">
          <activiti:string><![CDATA[Паспорт громадянина України для виїзду за кордон для дитини]]></activiti:string>
        </activiti:field>
        <activiti:field name="text">
          <activiti:expression><![CDATA[[pattern/mail/new_design/_common_header.html]
[pattern/mail/new_design/_common_content_start.html]

Ім'я дитини для якої зареєтровано місце в черзі: <b>${lastName_UA1} ${firstName_UA1} ${middleName_UA1}.</b><br>

<p>Відповіді на найчастіші питання по закордонних паспортах Ви можете знайти за <a href="https://docs.google.com/document/d/12tTbPz081dMJPxPicyXEe8xMMQdYNUet4Qx04VNCnys/edit?usp=sharing">посиланням</a></p><br>

										Для того щоб закінчити процедуру необхідно:<br>
										<ul>
											<li>У будь-якому банку сплатити адмінсбір та отримати квитанцію про сплату.Реквізити для сплати адмінсбору доступні за <b><a href="https://dmsu.gov.ua/services/payment.html" target="_blank">посиланням</a> </b> </li>
											<li>Прийти за адресою: ${sAddress} з необхідними документами.</li>
										</ul>
									</p>
									<p>
																			<b>Деталі зустрічі:</b><br>
	Номер талону - ${sTicketNumber}, орієнтовна дата та час візиту - ${sNotification_day}. 
</p>
									
									</p>
									<p>
										<b>Необхідні документи, які треба принести для оформлення паспорта громадянина України для виїзду за кордон для дитини:</b>
										<ul>
<br>
<li>свідоцтво про народження або паспорт громадянина України (для громадян, які досягли 14-річного віку);</li>

<br>
<li> якщо батьки або один із батьків дитини на момент її народження були іноземцями або особами без громадянства, також подається довідка про реєстрацію особи громадянином України (у разі оформлення вперше паспорта для виїзду за кордон із застосуванням засобів Реєстру);</li>	

<br>							
<li>квитанцію про сплату з мокрою печаткою банку, яка оформлена на одного з батьків з ким дитина зареєстрована (У призначенні платежу слід вказати ПІБ дитини, для якої буде оформлюватись закордонний паспорт!);</li>

<br>
<li>якщо на момент подання документів дитині виповнилось 12 років присутність дитини є обов'язковою! (якщо дитині не виповнилось 12 років потрібно надати одну фотокартку розміром 10х15 сантиметрів для внесення відцифрованого зображення особи шляхом сканування (обов'язково матове фото виконане на білому фоні, обличчя дитини займає не менше 80% фотографії,<a href="https://drive.google.com/open?id=0B68lQ-z45GpYZ01rS3ZFQUFvQ0FJWGRxcC05Rk5laUgzOGdN">зразок</a>), присутність дитини не обов'язкова);</li>

<br>
<li>потрібна присутність одного з батьків (усиновлювачів), опікунів, піклувальників або інших законних представників з оригіналом його паспорта;</li>

<br>
</ul>
</p>
<p>	
<b>Зверніть увагу:</b> 
<ul>
<li>Оплата здійснюється від імені одного з батьків, чиї дані потрібно внести при формуванні квитанції;</li>
<br>
<li style="color:red">У призначенні платежу слід вказати ПІБ дитини, для якої буде оформлюватись закордонний паспорт;</li>
<br>										
<li>Вам не потрібно буде реєструватися у черзі на місці. Вашого запису через iGov на вказаний час достатньо. Але дуже просимо Вас не запізнюватись, бо електронна черга має доволі чіткий крок.</li>
<br>
<li>У випадку, якщо Ви не зможете з`явитися ${sNotification_day} , Ви можете скасувати запис </li>
<br>
<li>Після подання документів Ви зможете перевіряти готовність свого паспорта за цим <a href="https://dmsu.gov.ua/services/docstate.html" target="_blank">посиланням</a> </li>
<br>
<li>Паспорт для виїзду за кордон, оформлений особі у віці від 12 до 16 років, може бути виданий особі, уповноваженій на це законним представником на підставі довіреності, засвідченої в установленому порядку, за умови присутності особи, на ім’я якої оформлено паспорт для виїзду за кордон.</li>
</ul>
</p>
<p>Якщо Вам потрібно скасувати заявку,  зверніться,  будь ласка, за телефонами: 097 470 05 05; 066 470 05 05; 073 470 05 05<br>
При цьому потрібно буде вказати код талону = ${sTicketCode}.<br>
Потім <b>обов'язково</b> натисніть кнопку, для скасувавання заявки на потралі
[cancelTaskSimple]
</p>                   
[pattern/mail/new_design/_common_content_end.html]
[pattern/mail/new_design/_common_signature_start.html]
${sNameOrgan},<br>
[pattern/mail/new_design/_common_signature_end.html]
[pattern/mail/new_design/_common_footer.html]]]></activiti:expression>
        </activiti:field>
      </extensionElements>
    </serviceTask>
    <sequenceFlow id="flow25" sourceRef="servicetask3" targetRef="usertask1"></sequenceFlow>
    <userTask id="usertask1" name="Заявка прийнята ДМС" activiti:candidateGroups="id_card_kiev">
      <extensionElements>
        <activiti:formProperty id="sCancelInfo" name="Чи скасована заявка (заповнюється громадянином лише у разі відміни запису, за замовчуванням вказано &quot;Заявка актуальна&quot;)" type="string"></activiti:formProperty>
        <activiti:formProperty id="bankIdlastName" name="Прізвище" type="string" writable="false"></activiti:formProperty>
        <activiti:formProperty id="bankIdfirstName" name="Ім'я" type="string" writable="false"></activiti:formProperty>
        <activiti:formProperty id="bankIdmiddleName" name="По батькові" type="string" writable="false"></activiti:formProperty>
        <activiti:formProperty id="tPassport" name="Паспортні дані; ;writable=false" type="textArea"></activiti:formProperty>
        <activiti:formProperty id="phone" name="Телефон громадянина" type="string" writable="false"></activiti:formProperty>
        <activiti:formProperty id="email" name="Електронна пошта громадянина" type="string" writable="false"></activiti:formProperty>
        <activiti:formProperty id="lastName_UA1" name="Прізвище дитини" type="string" writable="false"></activiti:formProperty>
        <activiti:formProperty id="firstName_UA1" name="Ім'я дитини" type="string" writable="false"></activiti:formProperty>
        <activiti:formProperty id="middleName_UA1" name="По батькові дитини" type="string" writable="false"></activiti:formProperty>
        <activiti:formProperty id="visitDay" name="Дата та час візиту - " type="queueData" writable="false"></activiti:formProperty>
        <activiti:formProperty id="asResult" name="Результат візиту" type="enum" required="true">
          <activiti:value id="attr1_ok" name="Громадянин з'явився у призначений час"></activiti:value>
          <activiti:value id="attr2_missed" name="Громадянин не з'явився"></activiti:value>
        </activiti:formProperty>
        <activiti:formProperty id="sCustom" name="Запуск таймера юзертаски" type="string" default="Auto"></activiti:formProperty>
        <activiti:formProperty id="sAddress" name="Адреса ДМС" type="string"></activiti:formProperty>
        <activiti:taskListener event="create" delegateExpression="${fileTaskUploadListener}"></activiti:taskListener>
      </extensionElements>
    </userTask>
    <boundaryEvent id="escalationTimer" name="Timer" attachedToRef="usertask1" cancelActivity="true">
      <timerEventDefinition>
        <timeDate>${sEndDay}</timeDate>
      </timerEventDefinition>
    </boundaryEvent>
    <sequenceFlow id="flow42" sourceRef="escalationTimer" targetRef="endevent2"></sequenceFlow>
    <endEvent id="endevent2" name="End">
      <extensionElements>
        <activiti:executionListener event="start" delegateExpression="${updateStatus_HistoryServiceEvent}"></activiti:executionListener>
      </extensionElements>
    </endEvent>
    <exclusiveGateway id="exclusivegateway1" name="Exclusive Gateway"></exclusiveGateway>
    <sequenceFlow id="flow44" sourceRef="startevent1" targetRef="servicetask1"></sequenceFlow>
    <serviceTask id="servicetask4" name="Лист чиновнику" activiti:delegateExpression="#{MailTaskWithoutAttachment}">
      <extensionElements>
        <activiti:field name="from">
          <activiti:string><![CDATA[noreply@igov.org.ua]]></activiti:string>
        </activiti:field>
        <activiti:field name="to">
          <activiti:expression><![CDATA[${sMailClerk}]]></activiti:expression>
        </activiti:field>
        <activiti:field name="subject">
          <activiti:expression><![CDATA[Нова заявка про ${sPosluga_name}]]></activiti:expression>
        </activiti:field>
        <activiti:field name="text">
          <activiti:expression><![CDATA[[pattern/mail/new_design/_common_employee_notify.html]]]></activiti:expression>
        </activiti:field>
      </extensionElements>
    </serviceTask>
    <serviceTask id="servicetask5" name="Лист заявнику" activiti:delegateExpression="#{MailTaskWithAttachmentsAndSMS}">
      <extensionElements>
        <activiti:field name="to">
          <activiti:expression><![CDATA[${email}]]></activiti:expression>
        </activiti:field>
        <activiti:field name="from">
          <activiti:string><![CDATA[noreply@igov.org.ua]]></activiti:string>
        </activiti:field>
        <activiti:field name="subject">
          <activiti:expression><![CDATA[${sPosluga_name}]]></activiti:expression>
        </activiti:field>
        <activiti:field name="text">
          <activiti:expression><![CDATA[[pattern/mail/new_design/_common_header.html]
[pattern/mail/new_design/_common_content_start.html]

Ім'я дитини для якої зареєтровано місце в черзі: <b>${lastName_UA1} ${firstName_UA1} ${middleName_UA1}.</b><br>

<p>Відповіді на найчастіші питання по закордонних паспортах Ви можете знайти за <a href="https://docs.google.com/document/d/12tTbPz081dMJPxPicyXEe8xMMQdYNUet4Qx04VNCnys/edit?usp=sharing">посиланням</a></p><br>
Для того щоб закінчити процедуру необхідно:<br>
<ul>
	<li>У будь-якому банку сплатити адмінсбір та отримати квитанцію про сплату.</li>
	<li>Прийти за адресою: ${sAddress} з необхідними документами.</li>
</ul>
</p>
Реквізити для сплати адмінсбору ${sRekvIDZagranPos}.<br>

<p>
<b>Деталі зустрічі:</b><br>
орієнтовна дата та час візиту - ${sNotification_day1}. 
</p>
									
</p>
<p>
<b>Необхідні документи, які треба принести для оформлення паспорта громадянина України для виїзду за кордон для дитини:</b>
<ul>
<br>
<li>квитанція, що підтверджує сплату адмінзбору оплатити за один-два дні до зазначеної дати прийому;</li>
<li>паспорт громадянина України батьків (оригінал);</li>
<li>свідоцтво про народження (для осіб до 14 років);</li>
<li>паспорт громадянина України (для осіб з 14 років);</li>
<li>довідка про реєстрацію місця проживання (форма№13) або витяг з Єдиного державного демографічного реєстру;</li>
<li>ідентифікаційний код платника податків, або повідомлення про відмову від його прийняття (оригінал);</li>
<li>паспорт громадянина України для виїзду за кордон (за наявності раніше оформлених в т.ч. діючий чи недіючий) ;</li>
<li>ідентифікаційний код платника податків, або повідомлення про відмову від його прийняття (оригінал);</li>

<li>якщо на момент подання документів дитині виповнилось 12 років присутність дитини є обов'язковою! (якщо дитині не виповнилось 12 років потрібно надати одну фотокартку розміром 10х15 сантиметрів для внесення відцифрованого зображення особи шляхом сканування (обов'язково матове фото виконане на білому фоні, обличчя дитини займає не менше 80% фотографії,<a href="https://drive.google.com/open?id=0B68lQ-z45GpYZ01rS3ZFQUFvQ0FJWGRxcC05Rk5laUgzOGdN">зразок</a>), присутність дитини не обов'язкова);</li><br>

<li>якщо батьки або один із батьків дитини на момент її народження були іноземцями або особами без громадянства, також подається довідка про реєстрацію особи громадянином України (у разі оформлення вперше паспорта для виїзду за кордон із застосуванням засобів Реєстру);</li><br>	

<li>Заява - згода батьків щодо оформлення паспорта громадянина України для виїзду за кордон дитині. У разі відсутності другого з батьків під час подання документів така заява подається  нотаріально завіреною.  У разі оформлення паспорта гр.України для виїзду за кордон особі, яка не досягла 16 - річного віку та проживає одним з батьків заявник подає оригінал одного з таких документів: 1) свідоцтво про смерть другого з батьків; 2) рішення суду про позбавлення батьківських прав другого з батьків; 3) Рішення суду про визнання другого з батьків безвісно відсутнім; 4) Рішення суду про визнання другого з батьків недієздатним; 5) Оригінал витягу з державного реєстру актів цивільного стану громадян про народження із зазначенням відомостей про батька відповідно до частини 1. ст. 135 сімейного кодексу України.;</li><br>
<br>
</ul>
</p>
<p>	
<b>Зверніть увагу:</b> 
<ul>
<li style="color:red">У призначенні платежу слід вказати ПІБ дитини, для якої буде оформлюватись закордонний паспорт;</li>
<br>										
<li>Вам не потрібно буде реєструватися у черзі на місці. Вашого запису через iGov на вказаний час достатньо. Але дуже просимо Вас не запізнюватись, бо електронна черга має доволі чіткий крок.</li>
<br>
<li>У випадку, якщо Ви не зможете з`явитися ${sNotification_day1} , Ви можете скасувати запис </li>
<br>
<li>Після подання документів Ви зможете перевіряти готовність свого паспорта за цим <a href="https://dmsu.gov.ua/services/docstate.html" target="_blank">посиланням</a> </li>
<br>
<li>Паспорт для виїзду за кордон, оформлений особі у віці від 12 до 16 років, може бути виданий особі, уповноваженій на це законним представником на підставі довіреності, засвідченої в установленому порядку, за умови присутності особи, на ім’я якої оформлено паспорт для виїзду за кордон.</li>
</ul>
</p>
<p>Якщо Вам потрібно скасувати заявку, натисніть кнопку, для скасувавання заявки на потралі
[cancelTask]</p>       	
							
[pattern/mail/new_design/_common_content_end.html]
[pattern/mail/new_design/_common_signature_start.html]
${sNameOrgan},<br>
[pattern/mail/new_design/_common_signature_end.html]
[pattern/mail/new_design/_common_footer.html]]]></activiti:expression>
        </activiti:field>
        <activiti:field name="sPhone_SMS">
          <activiti:expression><![CDATA[${phone}]]></activiti:expression>
        </activiti:field>
        <activiti:field name="sText_SMS">
          <activiti:expression><![CDATA[Vashe zvernennya [sID_Order] zareestrovano. Detali: igov.org.ua/journal abo u Vashomu email]]></activiti:expression>
        </activiti:field>
        <activiti:field name="saAttachmentsForSend">
          <activiti:expression><![CDATA[" "]]></activiti:expression>
        </activiti:field>
      </extensionElements>
    </serviceTask>
    <sequenceFlow id="flow46" sourceRef="servicetask4" targetRef="servicetask5"></sequenceFlow>
    <userTask id="usertask2" name="Обробка звернення" activiti:candidateGroups="dms_zagran_${sID_Public_SubjectOrganJoin}">
      <extensionElements>
        <activiti:formProperty id="sCancelInfo" name="Чи скасована заявка (заповнюється громадянином лише у разі відміни запису, за замовчуванням вказано &quot;Заявка актуальна&quot;)" type="string"></activiti:formProperty>
        <activiti:formProperty id="clFio" name="ПІБ заявника" type="string" default="${bankIdlastName} ${bankIdfirstName} ${bankIdmiddleName}" writable="false"></activiti:formProperty>
        <activiti:formProperty id="tPassport" name="Паспортні дані; ;writable=false" type="textArea"></activiti:formProperty>
        <activiti:formProperty id="phone" name="Телефон громадянина" type="string" writable="false"></activiti:formProperty>
        <activiti:formProperty id="email" name="Електронна пошта громадянина" type="string" writable="false"></activiti:formProperty>
        <activiti:formProperty id="lastName_UA1" name="Прізвище дитини" type="string" writable="false"></activiti:formProperty>
        <activiti:formProperty id="firstName_UA1" name="Ім'я дитини" type="string" writable="false"></activiti:formProperty>
        <activiti:formProperty id="middleName_UA1" name="По батькові дитини" type="string" writable="false"></activiti:formProperty>
        <activiti:formProperty id="visitDay1" name="Дата та час візиту - " type="queueData" writable="false"></activiti:formProperty>
        <activiti:formProperty id="asDecide" name="Рішення про надання послуги" type="enum" required="true">
          <activiti:value id="sEnamAccept" name="Послугу надоно, громаднин прийшов на прийом"></activiti:value>
          <activiti:value id="sEnamNeJavka" name="Громадянин не з'явився у визначений час"></activiti:value>
          <activiti:value id="sEnamReject" name="Відмова в наданні послуги"></activiti:value>
        </activiti:formProperty>
        <activiti:formProperty id="tComment" name="Вкажіть причину відмови" type="textArea"></activiti:formProperty>
        <activiti:formProperty id="markerDash" name="markerDash" type="markers" default="${markerService.loadFromFile('dms/DMSiGov_Dash.json')}"></activiti:formProperty>
      </extensionElements>
    </userTask>
    <sequenceFlow id="flow49" name="Відмова" sourceRef="exclusivegateway2" targetRef="servicetask6">
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[${asDecide == 'sEnamReject'}]]></conditionExpression>
    </sequenceFlow>
    <sequenceFlow id="flow50" name="Фідбек" sourceRef="exclusivegateway2" targetRef="servicetask7">
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[${asDecide == 'sEnamAccept'}]]></conditionExpression>
    </sequenceFlow>
    <sequenceFlow id="flow51" name="Неявка заявника" sourceRef="exclusivegateway2" targetRef="servicetask8">
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[${asDecide == 'sEnamNeJavka'}]]></conditionExpression>
    </sequenceFlow>
    <sequenceFlow id="flow47" sourceRef="servicetask5" targetRef="usertask2"></sequenceFlow>
    <exclusiveGateway id="exclusivegateway2" name="Exclusive Gateway"></exclusiveGateway>
    <sequenceFlow id="flow48" sourceRef="usertask2" targetRef="exclusivegateway2"></sequenceFlow>
    <serviceTask id="servicetask6" name="Відмова" activiti:delegateExpression="#{MailTaskWithAttachmentsAndSMS}">
      <extensionElements>
        <activiti:field name="to">
          <activiti:expression><![CDATA[${email}]]></activiti:expression>
        </activiti:field>
        <activiti:field name="from">
          <activiti:string><![CDATA[noreply@igov.org.ua]]></activiti:string>
        </activiti:field>
        <activiti:field name="subject">
          <activiti:expression><![CDATA[${sPosluga_name}]]></activiti:expression>
        </activiti:field>
        <activiti:field name="text">
          <activiti:expression><![CDATA[[pattern/mail/new_design/_common_header.html]
[pattern/mail/new_design/_common_content_start.html]
На жаль, послугу не можливо надати.<br> 
Причина: ${tComment}.<br><br>
Ви можете усунути недоліки і подати ще одну заявку на порталі <a href="https://igov.org.ua/">igov.org.ua</a>
[pattern/mail/new_design/_common_content_end.html]
[pattern/mail/new_design/_common_signature_start.html]
${sNameOrgan}<br>
[pattern/mail/new_design/_common_signature_end.html]
[pattern/mail/new_design/_common_footer.html]]]></activiti:expression>
        </activiti:field>
        <activiti:field name="sPhone_SMS">
          <activiti:expression><![CDATA[${phone}]]></activiti:expression>
        </activiti:field>
        <activiti:field name="sText_SMS">
          <activiti:expression><![CDATA[Za Vashym zvernennyam [sID_Order] vyneseno vidmovu v nadanni poslugy. Detali: igov.org.ua/journal abo u Vashomu email]]></activiti:expression>
        </activiti:field>
        <activiti:field name="saAttachmentsForSend">
          <activiti:expression><![CDATA[" "]]></activiti:expression>
        </activiti:field>
      </extensionElements>
    </serviceTask>
    <serviceTask id="servicetask7" name="Фідбек" activiti:delegateExpression="#{MailTaskWithoutAttachment}">
      <extensionElements>
        <activiti:field name="to">
          <activiti:expression><![CDATA[${email}]]></activiti:expression>
        </activiti:field>
        <activiti:field name="from">
          <activiti:string><![CDATA[noreply@igov.org.ua]]></activiti:string>
        </activiti:field>
        <activiti:field name="subject">
          <activiti:expression><![CDATA[${sPosluga_name}]]></activiti:expression>
        </activiti:field>
        <activiti:field name="text">
          <activiti:expression><![CDATA[[pattern/mail/new_design/_common_header.html]
[pattern/mail/new_design/_common_content_start.html]
[pattern/mail/new_design/_common_content_end.html]
[pattern/mail/new_design/_common_feedback.html]
[pattern/mail/new_design/_common_signature_start.html]
${sNameOrgan}<br>
[pattern/mail/new_design/_common_signature_end.html]
[pattern/mail/new_design/_common_footer.html]]]></activiti:expression>
        </activiti:field>
      </extensionElements>
    </serviceTask>
    <serviceTask id="servicetask8" name="Заявка закрита" activiti:delegateExpression="#{MailTaskWithAttachmentsAndSMS}">
      <extensionElements>
        <activiti:field name="to">
          <activiti:expression><![CDATA[${email}]]></activiti:expression>
        </activiti:field>
        <activiti:field name="from">
          <activiti:string><![CDATA[noreply@igov.org.ua]]></activiti:string>
        </activiti:field>
        <activiti:field name="subject">
          <activiti:expression><![CDATA[${sPosluga_name}]]></activiti:expression>
        </activiti:field>
        <activiti:field name="text">
          <activiti:expression><![CDATA[[pattern/mail/new_design/_common_header.html]
[pattern/mail/new_design/_common_content_start.html]
Ви не зв'явились для отримання послуги у обраний вами час.<br> 
<p>
	<b>Деталі візиту</b>
<ul>
	<li>Адреса:  ${sAddress}.</li>
	<li>Дата та час: ${sNotification_day1}</li>
</ul>
</p>
В зв'язку з неявкою заявка закрита.<br> 

Ви можете усунути недоліки і подати ще одну заявку на порталі <a href="https://igov.org.ua/">igov.org.ua</a>
[pattern/mail/new_design/_common_content_end.html]
[pattern/mail/new_design/_common_signature_start.html]
${sNameOrgan}<br>
[pattern/mail/new_design/_common_signature_end.html]
[pattern/mail/new_design/_common_footer.html]]]></activiti:expression>
        </activiti:field>
        <activiti:field name="sPhone_SMS">
          <activiti:expression><![CDATA[${phone}]]></activiti:expression>
        </activiti:field>
        <activiti:field name="sText_SMS">
          <activiti:expression><![CDATA[Za Vashym zvernennyam [sID_Order] zakryto zayavku cherez neyavku. Detali: igov.org.ua/journal abo u Vashomu email]]></activiti:expression>
        </activiti:field>
        <activiti:field name="saAttachmentsForSend">
          <activiti:expression><![CDATA[" "]]></activiti:expression>
        </activiti:field>
      </extensionElements>
    </serviceTask>
    <endEvent id="endevent4" name="End"></endEvent>
    <sequenceFlow id="flow52" sourceRef="servicetask7" targetRef="endevent4"></sequenceFlow>
    <serviceTask id="servicetask9" name="Прибрати слот" activiti:delegateExpression="#{releaseTicketsOfQueue}"></serviceTask>
    <sequenceFlow id="flow53" sourceRef="servicetask6" targetRef="servicetask9"></sequenceFlow>
    <sequenceFlow id="flow54" sourceRef="servicetask8" targetRef="endevent4"></sequenceFlow>
    <sequenceFlow id="flow55" sourceRef="servicetask9" targetRef="endevent4"></sequenceFlow>
    <scriptTask id="scripttask3" name="Скріпт ЦНАП" scriptFormat="javascript" activiti:autoStoreVariables="false">
      <script>var src1=execution.getVariable('visitDay1')
var date_of_visit1=src1.substr(src1.indexOf('"sDate":"')+9,16);
execution.setVariable('sNotification_day1', date_of_visit1)</script>
    </scriptTask>
    <sequenceFlow id="flow56" sourceRef="scripttask3" targetRef="servicetask4"></sequenceFlow>
  </process>
  <bpmndi:BPMNDiagram id="BPMNDiagram_dms_0177_zagranChild_DMSiGov">
    <bpmndi:BPMNPlane bpmnElement="dms_0177_zagranChild_DMSiGov" id="BPMNPlane_dms_0177_zagranChild_DMSiGov">
      <bpmndi:BPMNShape bpmnElement="startevent1" id="BPMNShape_startevent1">
        <omgdc:Bounds height="35.0" width="35.0" x="51.0" y="90.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="servicetask1" id="BPMNShape_servicetask1">
        <omgdc:Bounds height="55.0" width="105.0" x="137.0" y="80.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="boundaryerror1" id="BPMNShape_boundaryerror1">
        <omgdc:Bounds height="30.0" width="30.0" x="213.0" y="79.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="endevent3" id="BPMNShape_endevent3">
        <omgdc:Bounds height="35.0" width="35.0" x="210.0" y="20.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="scripttask1" id="BPMNShape_scripttask1">
        <omgdc:Bounds height="55.0" width="105.0" x="371.0" y="80.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="servicetask3" id="BPMNShape_servicetask3">
        <omgdc:Bounds height="55.0" width="105.0" x="494.0" y="80.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="usertask1" id="BPMNShape_usertask1">
        <omgdc:Bounds height="55.0" width="105.0" x="631.0" y="80.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="escalationTimer" id="BPMNShape_escalationTimer">
        <omgdc:Bounds height="30.0" width="30.0" x="722.0" y="94.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="endevent2" id="BPMNShape_endevent2">
        <omgdc:Bounds height="35.0" width="35.0" x="800.0" y="91.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="exclusivegateway1" id="BPMNShape_exclusivegateway1">
        <omgdc:Bounds height="40.0" width="40.0" x="279.0" y="88.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="servicetask4" id="BPMNShape_servicetask4">
        <omgdc:Bounds height="55.0" width="105.0" x="247.0" y="250.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="servicetask5" id="BPMNShape_servicetask5">
        <omgdc:Bounds height="55.0" width="105.0" x="247.0" y="330.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="usertask2" id="BPMNShape_usertask2">
        <omgdc:Bounds height="55.0" width="105.0" x="247.0" y="410.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="exclusivegateway2" id="BPMNShape_exclusivegateway2">
        <omgdc:Bounds height="40.0" width="40.0" x="279.0" y="489.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="servicetask6" id="BPMNShape_servicetask6">
        <omgdc:Bounds height="55.0" width="105.0" x="130.0" y="482.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="servicetask7" id="BPMNShape_servicetask7">
        <omgdc:Bounds height="55.0" width="105.0" x="247.0" y="568.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="servicetask8" id="BPMNShape_servicetask8">
        <omgdc:Bounds height="55.0" width="105.0" x="371.0" y="482.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="endevent4" id="BPMNShape_endevent4">
        <omgdc:Bounds height="35.0" width="35.0" x="282.0" y="660.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="servicetask9" id="BPMNShape_servicetask9">
        <omgdc:Bounds height="55.0" width="105.0" x="130.0" y="568.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="scripttask3" id="BPMNShape_scripttask3">
        <omgdc:Bounds height="55.0" width="105.0" x="247.0" y="161.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge bpmnElement="flow1" id="BPMNEdge_flow1">
        <omgdi:waypoint x="319.0" y="108.0"></omgdi:waypoint>
        <omgdi:waypoint x="371.0" y="107.0"></omgdi:waypoint>
        <bpmndi:BPMNLabel>
          <omgdc:Bounds height="14.0" width="54.0" x="382.0" y="66.0"></omgdc:Bounds>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow45" id="BPMNEdge_flow45">
        <omgdi:waypoint x="299.0" y="128.0"></omgdi:waypoint>
        <omgdi:waypoint x="299.0" y="161.0"></omgdi:waypoint>
        <bpmndi:BPMNLabel>
          <omgdc:Bounds height="14.0" width="53.0" x="311.0" y="147.0"></omgdc:Bounds>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow23" id="BPMNEdge_flow23">
        <omgdi:waypoint x="228.0" y="79.0"></omgdi:waypoint>
        <omgdi:waypoint x="227.0" y="55.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow10" id="BPMNEdge_flow10">
        <omgdi:waypoint x="242.0" y="107.0"></omgdi:waypoint>
        <omgdi:waypoint x="279.0" y="108.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow28" id="BPMNEdge_flow28">
        <omgdi:waypoint x="476.0" y="107.0"></omgdi:waypoint>
        <omgdi:waypoint x="494.0" y="107.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow25" id="BPMNEdge_flow25">
        <omgdi:waypoint x="599.0" y="107.0"></omgdi:waypoint>
        <omgdi:waypoint x="631.0" y="107.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow42" id="BPMNEdge_flow42">
        <omgdi:waypoint x="752.0" y="109.0"></omgdi:waypoint>
        <omgdi:waypoint x="800.0" y="108.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow44" id="BPMNEdge_flow44">
        <omgdi:waypoint x="86.0" y="107.0"></omgdi:waypoint>
        <omgdi:waypoint x="137.0" y="107.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow46" id="BPMNEdge_flow46">
        <omgdi:waypoint x="299.0" y="305.0"></omgdi:waypoint>
        <omgdi:waypoint x="299.0" y="330.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow49" id="BPMNEdge_flow49">
        <omgdi:waypoint x="279.0" y="509.0"></omgdi:waypoint>
        <omgdi:waypoint x="235.0" y="509.0"></omgdi:waypoint>
        <bpmndi:BPMNLabel>
          <omgdc:Bounds height="14.0" width="42.0" x="115.0" y="465.0"></omgdc:Bounds>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow50" id="BPMNEdge_flow50">
        <omgdi:waypoint x="299.0" y="529.0"></omgdi:waypoint>
        <omgdi:waypoint x="299.0" y="568.0"></omgdi:waypoint>
        <bpmndi:BPMNLabel>
          <omgdc:Bounds height="14.0" width="33.0" x="311.0" y="555.0"></omgdc:Bounds>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow51" id="BPMNEdge_flow51">
        <omgdi:waypoint x="319.0" y="509.0"></omgdi:waypoint>
        <omgdi:waypoint x="371.0" y="509.0"></omgdi:waypoint>
        <bpmndi:BPMNLabel>
          <omgdc:Bounds height="14.0" width="87.0" x="391.0" y="469.0"></omgdc:Bounds>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow47" id="BPMNEdge_flow47">
        <omgdi:waypoint x="299.0" y="385.0"></omgdi:waypoint>
        <omgdi:waypoint x="299.0" y="410.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow48" id="BPMNEdge_flow48">
        <omgdi:waypoint x="299.0" y="465.0"></omgdi:waypoint>
        <omgdi:waypoint x="299.0" y="489.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow52" id="BPMNEdge_flow52">
        <omgdi:waypoint x="299.0" y="623.0"></omgdi:waypoint>
        <omgdi:waypoint x="299.0" y="660.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow53" id="BPMNEdge_flow53">
        <omgdi:waypoint x="182.0" y="537.0"></omgdi:waypoint>
        <omgdi:waypoint x="182.0" y="568.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow54" id="BPMNEdge_flow54">
        <omgdi:waypoint x="423.0" y="537.0"></omgdi:waypoint>
        <omgdi:waypoint x="423.0" y="677.0"></omgdi:waypoint>
        <omgdi:waypoint x="317.0" y="677.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow55" id="BPMNEdge_flow55">
        <omgdi:waypoint x="182.0" y="623.0"></omgdi:waypoint>
        <omgdi:waypoint x="182.0" y="677.0"></omgdi:waypoint>
        <omgdi:waypoint x="282.0" y="677.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow56" id="BPMNEdge_flow56">
        <omgdi:waypoint x="299.0" y="216.0"></omgdi:waypoint>
        <omgdi:waypoint x="299.0" y="250.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</definitions>